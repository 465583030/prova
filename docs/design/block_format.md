# RMG Block Format

From the basic starting point of Bitcoin's data structures, the RMG chain extends and changes some elements to suit its design goals.

## Block Header Modifications from Bitcoin

### Additional elements

1. 33-byte compressed Validator public key
2. 80-byte block Validator signature
3. 4-byte uint32 block height
4. 4-byte uint32 block size

RMG blocks must be generated by holders of Validating Keys. To prove the authorship of the blocks, a Validating public key and a corresponding block signature are added. The validating signature is a signature of:

```
sha3(
  [version]
  [timestamp]
  [prevBlockHash]
  [merkleRoot]
)
```

In Bitcoin, the block height was soft forked into the consensus rules in [BIP-34](https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki). Block height therefore was placed in the coinbase and not the blockheader.

The block size is added to the RMG header as it is important metadata and consensus critical, this commitment can help improve the validation level of headers-only syncing clients.

### Changes to existing fields

1. The 4-byte nonce is changed to an 8 byte nonce, eliminating the need for the extraNonce typically used in the coinbase.
2. The 4-byte timestamp is changed to an 8 byte timestamp, solving the year 2106 issue.
3. The transactions Merkle Root is altered to commit to both signature-covering and non-signature-covering versions of the transaction id hashes.

## Header Serialization Changes

The serialization of the header must be changed to support the new field sizes and fields. The encodings are still little-endian, as in Bitcoin.

In Bitcoin, the header serialization is:

```
[4-byte uint32 version]
[32-byte previous block header hash]
[32-byte merkle root hash]
[4-byte uint32 time]
[4-byte uint32 difficulty target bits]
[4-byte uint32 nonce]
```

In RMG, the header serialization is:

```
[4-byte uint32 version]
[32-byte previous block header hash]
[32-byte merkle root hash]
[8-byte uint64 time]
[4-byte uint32 difficulty target bits]
[4-byte uint32 height]
[4-byte uint32 block size]
[8-byte uint64 nonce]
[33-byte validating compressed public key]
[80-byte block validating signature]
```

## Removals from the Coinbase:

The block height and the extraNonce are removed from the Coinbase, as is the SegWit additional merkle root.

The motivation for removing these elements is to clean up the Bitcoin metadata representation by moving components from the originally undefined data structure that is the Coinbase scriptSig to a strictly defined data structure that is the header.

## Changes to the hash function:

1. The block hash is changed from a double round of SHA256 to a single SHA3 hash.

The reason that double rounds of SHA256 were used in Bitcoin was as a response to an earlier cryptographic weakness of single-round SHA1 that never materialized in SHA256, which was at design-time of Bitcoin the latest version of the SHA hashing standard.

Since that time, [SHA3 Keccak](https://en.wikipedia.org/wiki/SHA-3) has been selected as the successor to SHA256 algorithm, so it is used instead. Selecting another [Hashcash](http://www.hashcash.org/) algorithm is also desired to help prevent the potentially randomizing influence of SHA256's widely available ASIC hashing hardware.

## Transaction Changes

Transactions in RMG are unchanged from standard Bitcoin transactions, other than in the way that transaction ids are specified. When serializing an RMG transaction for the purposes of spending a tx outpoint, the signature bytes are omitted and a zero byte is put in their place.

The rationale for this change is to prevent third party transaction id malleability. Allowing arbitrary third parties to change transaction ids is undesirable because it is confusing for development, complicated to handle, and can break chains of transactions or un-broadcast transactions.

## Value Divisibility Changes

The smallest unit of value on the RMG chain is called an **Atom**. Whereas in Bitcoin, 1 BTC = 1e8 Satoshi, in the RMG system, 1 RMG (1 gold gram) = 1e6 atoms.
